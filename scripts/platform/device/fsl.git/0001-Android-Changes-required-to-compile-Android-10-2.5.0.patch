From a2b638326afa96689046c8caf53b7e1ca17001c2 Mon Sep 17 00:00:00 2001
From: Harshesh Valera <harshesh.v@variscite.com>
Date: Thu, 19 Nov 2020 14:15:09 -0800
Subject: [PATCH] Android: Changes required to compile Android 10 2.5.0 for 
 device/variscite.

Signed-off-by: Harshesh Valera <harshesh.v@variscite.com>
---
 common/build/Makefile    | 7 ++++---
 common/tools/imx-make.sh | 7 ++++---
 2 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/common/build/Makefile b/common/build/Makefile
index b2c9a41..cf5547e 100644
--- a/common/build/Makefile
+++ b/common/build/Makefile
@@ -23,13 +23,14 @@ HOST_PREBUILT_TAG := $(HOST_OS)-${HOST_PREBUILT_ARCH}
 
 # firstly to include UbootKernelCommonConfig.mk, then SharedBoardConfig.mk, finally UbootKernelBoardConfig.mk
 
-include ${fsl_git_path}/common/imx_path/ImxPathConfig.mk
+-include ${fsl_git_path}/../fsl/common/imx_path/ImxPathConfig.mk
+include ${fsl_git_path}/common/VarPathConfig.mk
 include ${soc_path}/UbootKernelCommonConfig.mk
 include ${product_path}/SharedBoardConfig.mk
 include ${product_path}/UbootKernelBoardConfig.mk
 
-include ${fsl_git_path}/common/build/kernel.mk
-include ${fsl_git_path}/common/build/uboot.mk
+include ${fsl_git_path}/../fsl/common/build/kernel.mk
+include ${fsl_git_path}/../fsl/common/build/uboot.mk
 -include ${product_path}/AndroidUboot.mk
 -include ${product_path}/AndroidTee.mk
 -include ${GPU_VIV6_PATH}/gpu-viv6/driver/hal/kernel/galcore.mk
diff --git a/common/tools/imx-make.sh b/common/tools/imx-make.sh
index 45fa713..ee7b83f 100755
--- a/common/tools/imx-make.sh
+++ b/common/tools/imx-make.sh
@@ -117,10 +117,11 @@ if [ -n "${build_kernel}" ] && [ ${TARGET_PRODUCT} = "evk_8mp" ]; then
     build_vvcam="vvcam";
 fi
 
-product_makefile=`pwd`/`find device/fsl -maxdepth 4 -name "${TARGET_PRODUCT}.mk"`;
+product_makefile=`pwd`/`find device/variscite -maxdepth 4 -name "${TARGET_PRODUCT}.mk"`;
 product_path=${product_makefile%/*}
 soc_path=${product_path%/*}
 fsl_git_path=${soc_path%/*}
+export AARCH64_GCC_CROSS_COMPILE=$ANDROID_BUILD_TOP/prebuilts/gcc/linux-x86/aarch64/gcc-arm-8.3-2019.03-x86_64-aarch64-linux-gnu/bin/aarch64-linux-gnu-
 
 # if uboot is to be compiled, remove the UBOOT_COLLECTION directory
 if [ -n "${build_bootloader}" ]; then
@@ -153,11 +154,11 @@ apply_patch
 
 # redirect standard input to /dev/null to avoid manually input in kernel configuration stage
 soc_path=${soc_path} product_path=${product_path} fsl_git_path=${fsl_git_path} clean_build=${clean_build} \
-    make -C ./ -f ${fsl_git_path}/common/build/Makefile ${parallel_option} \
+    make -C ./ -f ${fsl_git_path}/../fsl/common/build/Makefile ${parallel_option} \
     ${build_bootloader} ${build_kernel} </dev/null || exit
 
 soc_path=${soc_path} product_path=${product_path} fsl_git_path=${fsl_git_path} clean_build=${clean_build} \
-    make -C ./ -f ${fsl_git_path}/common/build/Makefile ${parallel_option} \
+    make -C ./ -f ${fsl_git_path}/../fsl/common/build/Makefile ${parallel_option} \
     ${build_vvcam} ${build_galcore} </dev/null || exit
 
 if [ ${build_android_flag} -eq 1 ]; then
-- 
2.25.1

